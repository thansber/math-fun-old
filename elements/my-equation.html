<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-a11y-keys/core-a11y-keys.html">

<polymer-element name="my-equation" attributes="number1 number2 operation">
  <template>
    <style>
      #equation {
        border-bottom: 20px solid white;
      }
      #answer {
        background-color: #3c3c3c;
        border: 0;
        color: white;
        font-size: 8vw;
        margin-top: 20px;
        padding: 0;
        text-align: right;
        width: 17vw;
      }
      [result] {
        bottom: 8%;
        font-size: 40px;
        left: 20%;
        position: absolute;
      }
      [result][correct] {
        left: 20%;
      }
      [result][incorrect] {
        left: 12%;
      }
    </style>
    <div id="equation" layout horizontal end-justified>
      <div id="operation" self-end>{{symbol.text}}</div>
      <div id="numbers" layout vertical end>
        <div id="number1">{{number1}}</div>
        <div id="number2">{{number2}}</div>
      </div>
    </div>
    <input id="answer" type="text" maxlength="2" autocomplete="off" autofocus on-blur="{{refocusAnswer}}"/>
    <span correct result hidden?="{{ !hasAnswer || !correct }}">Correct!</span>
    <span incorrect result hidden?="{{ !hasAnswer || correct }}">Close...try again</span>
    <core-a11y-keys keys="space enter" target="{{$.answer}}" on-keys-pressed="{{checkAnswer}}"></core-a11y-keys>
  </template>

  <script>
    Polymer('my-equation', {
      symbols: {
        ADDITION: {
          text: '+',
          calculate: function(a, b) { return a + b; }
        },
        SUBTRACTION: {
          text: '-',
          calculate: function(a, b) { return a - b; }
        }
      },
      checkAnswer: function() {
        var expected = this.symbol.calculate(+this.number1, +this.number2);
        this.hasAnswer = true;
        this.correct = expected === +this.$.answer.value;

        if (this.correct) {
          this.fire('correct-answer');
        } else {
          this.refocusAnswer();
        }
      },
      clearAnswer: function() {
        this.$.answer.value = '';
      },
      created: function() {
        this.correct = false;
        this.hasAnswer = false;
      },
      operationChanged: function() {
        this.symbol = this.symbols[this.operation.toUpperCase()];
      },
      refocusAnswer: function() {
        this.$.answer.focus();
        this.$.answer.select();
      }
    });
  </script>
</polymer-element>